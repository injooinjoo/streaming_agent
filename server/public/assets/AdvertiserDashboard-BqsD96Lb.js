import{r as d,n as $,j as e,F as Q,I as ne,G as E,V as J,J as W,K as ce,p as X,N as Y,b as K,X as re,D,g as q,O as Z,P as ee,Q as se,E as ae,W as te,T as ie,d as le,l as de,o as oe,a as me,Y as he,_ as M,$ as xe,x as V,B as pe,f as je,C as ue,L as ge,a0 as G,a1 as ve}from"./index-CFQ16FjH.js";const H=({campaign:s,onBack:o,onSuccess:P})=>{const[i,m]=d.useState({name:"",content_type:"image",content_url:"",click_url:"",budget_daily:0,budget_total:0,cpm:1e3,cpc:100,start_date:"",end_date:"",target_streamers:"all",target_categories:[]}),[N,j]=d.useState([]),[F,T]=d.useState(""),[u,_]=d.useState([]),[g,k]=d.useState(null),[C,f]=d.useState(!1),[l,h]=d.useState(!1),[n,S]=d.useState({}),R=d.useRef(null),z=!!s;d.useEffect(()=>{if(s){if(m({name:s.name||"",content_type:s.content_type||"image",content_url:s.content_url||"",click_url:s.click_url||"",budget_daily:s.budget_daily||0,budget_total:s.budget_total||0,cpm:s.cpm||1e3,cpc:s.cpc||100,start_date:s.start_date?.split("T")[0]||"",end_date:s.end_date?.split("T")[0]||"",target_streamers:s.target_streamers||"all",target_categories:s.target_categories?JSON.parse(s.target_categories):[]}),s.target_streamers&&s.target_streamers!=="all")try{j(JSON.parse(s.target_streamers))}catch{j([])}s.content_url&&k({url:s.content_url,type:s.content_type})}w()},[s]);const w=async()=>{try{const a=localStorage.getItem("token"),c=await fetch(`${$}/api/users/streamers`,{headers:{Authorization:`Bearer ${a}`}});if(c.ok){const r=await c.json();_(r)}}catch(a){console.error("Failed to fetch streamers",a),_([{id:1,display_name:"스트리머A",viewers_avg:1200},{id:2,display_name:"스트리머B",viewers_avg:850},{id:3,display_name:"스트리머C",viewers_avg:2100},{id:4,display_name:"게임방송D",viewers_avg:560},{id:5,display_name:"토크방송E",viewers_avg:340}])}},x=(a,c)=>{m(r=>({...r,[a]:c})),n[a]&&S(r=>({...r,[a]:null}))},O=async a=>{const c=a.target.files[0];if(!c)return;const r=c.type.startsWith("image/"),L=c.type.startsWith("video/");if(!r&&!L){S(y=>({...y,content:"이미지 또는 동영상 파일만 업로드 가능합니다."}));return}const A=URL.createObjectURL(c);k({url:A,file:c,type:L?"video":"image"}),m(y=>({...y,content_type:L?"video":"image"})),f(!0),setTimeout(()=>{m(y=>({...y,content_url:A})),f(!1)},1e3)},t=a=>{i.target_streamers==="all"&&m(r=>({...r,target_streamers:"selected"}));const c=N.find(r=>r.id===a.id);j(c?r=>r.filter(L=>L.id!==a.id):r=>[...r,a])},p=a=>{j(c=>c.filter(r=>r.id!==a)),N.length<=1&&m(c=>({...c,target_streamers:"all"}))},v=a=>{i.target_categories.includes(a)?x("target_categories",i.target_categories.filter(r=>r!==a)):x("target_categories",[...i.target_categories,a])},B=()=>{const a={};return i.name.trim()||(a.name="캠페인 이름을 입력해주세요."),!i.content_url&&!g&&(a.content="광고 콘텐츠를 업로드해주세요."),i.budget_total<=0&&(a.budget="총 예산을 입력해주세요."),i.start_date||(a.start_date="시작일을 선택해주세요."),i.end_date||(a.end_date="종료일을 선택해주세요."),i.start_date&&i.end_date&&i.start_date>i.end_date&&(a.end_date="종료일은 시작일 이후여야 합니다."),S(a),Object.keys(a).length===0},U=async a=>{if(a.preventDefault(),!!B()){h(!0);try{const c=localStorage.getItem("token"),r={...i,target_streamers:i.target_streamers==="all"?"all":JSON.stringify(N.map(y=>y.id)),target_categories:JSON.stringify(i.target_categories)},L=z?`${$}/api/ads/campaigns/${s.id}`:`${$}/api/ads/campaigns`,A=await fetch(L,{method:z?"PUT":"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify(r)});if(A.ok)P();else{const y=await A.json();S({submit:y.error||"캠페인 저장에 실패했습니다."})}}catch(c){console.error("Failed to save campaign",c),S({submit:"네트워크 오류가 발생했습니다."})}finally{h(!1)}}},b=[{id:"game",label:"게임"},{id:"talk",label:"토크/잡담"},{id:"music",label:"음악"},{id:"art",label:"그림/창작"},{id:"sports",label:"스포츠"},{id:"education",label:"교육"}],I=u.filter(a=>a.display_name?.toLowerCase().includes(F.toLowerCase()));return e.jsxs("div",{className:"animate-fade",children:[e.jsx("header",{className:"page-header",children:e.jsxs("div",{className:"page-title",style:{display:"flex",alignItems:"center",gap:"16px"},children:[e.jsx("button",{className:"btn-outline",style:{padding:"10px",borderRadius:"10px"},onClick:o,children:e.jsx(Q,{size:18})}),e.jsxs("div",{children:[e.jsx("h1",{children:z?"캠페인 수정":"새 캠페인 만들기"}),e.jsx("p",{children:z?"캠페인 설정을 수정합니다.":"광고 캠페인을 생성하고 스트리머에게 노출하세요."})]})]})}),e.jsxs("form",{onSubmit:U,className:"campaign-form-container",children:[e.jsxs("div",{className:"campaign-form-card",children:[e.jsxs("h3",{children:[e.jsx(ne,{size:18})," 기본 정보"]}),e.jsx("div",{className:"form-row single",children:e.jsxs("div",{className:"form-field",children:[e.jsx("label",{children:"캠페인 이름 *"}),e.jsx("input",{type:"text",placeholder:"예: 신작 게임 런칭 광고",value:i.name,onChange:a=>x("name",a.target.value)}),n.name&&e.jsx("span",{className:"hint",style:{color:"#ef4444"},children:n.name})]})})]}),e.jsxs("div",{className:"campaign-form-card",children:[e.jsxs("h3",{children:[e.jsx(E,{size:18})," 광고 콘텐츠"]}),e.jsx("div",{className:"form-row single",children:e.jsxs("div",{className:"form-field",children:[e.jsx("label",{children:"광고 유형"}),e.jsxs("div",{style:{display:"flex",gap:"12px",marginTop:"8px"},children:[e.jsxs("button",{type:"button",className:`mode-btn ${i.content_type==="image"?"active":""}`,onClick:()=>x("content_type","image"),style:{flex:1},children:[e.jsx(E,{size:18})," 이미지"]}),e.jsxs("button",{type:"button",className:`mode-btn ${i.content_type==="video"?"active":""}`,onClick:()=>x("content_type","video"),style:{flex:1},children:[e.jsx(J,{size:18})," 동영상"]})]})]})}),e.jsx("div",{className:"form-row single",children:e.jsxs("div",{className:"form-field",children:[e.jsx("label",{children:"광고 파일 업로드 *"}),e.jsxs("div",{className:`file-upload-area ${g?"has-file":""}`,onClick:()=>R.current?.click(),children:[e.jsx("input",{ref:R,type:"file",accept:"image/*,video/*",style:{display:"none"},onChange:O}),C?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"file-upload-icon",children:e.jsx(W,{size:24,className:"spin"})}),e.jsx("h4",{children:"업로드 중..."})]}):g?e.jsxs("div",{className:"file-preview",children:[g.type==="video"?e.jsx("video",{src:g.url,style:{maxHeight:"120px"},controls:!0}):e.jsx("img",{src:g.url,alt:"Preview"}),e.jsx("span",{className:"file-preview-name",children:g.file?.name||"업로드된 파일"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"file-upload-icon",children:e.jsx(W,{size:24})}),e.jsx("h4",{children:"파일을 드래그하거나 클릭하여 업로드"}),e.jsx("p",{children:"PNG, JPG, GIF, MP4, WebM (최대 50MB)"})]})]}),n.content&&e.jsx("span",{className:"hint",style:{color:"#ef4444"},children:n.content})]})}),e.jsx("div",{className:"form-row single",children:e.jsxs("div",{className:"form-field",children:[e.jsxs("label",{children:[e.jsx(ce,{size:14})," 클릭 URL (선택)"]}),e.jsx("input",{type:"url",placeholder:"https://example.com/landing-page",value:i.click_url,onChange:a=>x("click_url",a.target.value)}),e.jsx("span",{className:"hint",children:"광고 클릭 시 이동할 페이지 주소"})]})})]}),e.jsxs("div",{className:"campaign-form-card",children:[e.jsxs("h3",{children:[e.jsx(X,{size:18})," 타겟팅 설정"]}),e.jsx("div",{className:"form-row single",children:e.jsxs("div",{className:"form-field",children:[e.jsx("label",{children:"노출 대상 스트리머"}),e.jsxs("div",{className:"targeting-grid",children:[e.jsx("div",{className:`targeting-option ${i.target_streamers==="all"?"selected":""}`,onClick:()=>{m(a=>({...a,target_streamers:"all"})),j([])},children:e.jsx("span",{children:"전체 스트리머"})}),e.jsx("div",{className:`targeting-option ${i.target_streamers==="selected"?"selected":""}`,onClick:()=>m(a=>({...a,target_streamers:"selected"})),children:e.jsx("span",{children:"선택한 스트리머만"})})]})]})}),i.target_streamers==="selected"&&e.jsx("div",{className:"form-row single",style:{marginTop:"16px"},children:e.jsxs("div",{className:"form-field",children:[e.jsxs("div",{className:"streamer-search",children:[e.jsx(Y,{size:16,className:"streamer-search-icon"}),e.jsx("input",{type:"text",placeholder:"스트리머 검색...",value:F,onChange:a=>T(a.target.value)})]}),e.jsx("div",{className:"streamer-list",children:I.map(a=>{const c=N.some(r=>r.id===a.id);return e.jsxs("div",{className:`streamer-item ${c?"selected":""}`,onClick:()=>t(a),children:[e.jsx("div",{className:"streamer-avatar",children:a.display_name?.charAt(0)?.toUpperCase()}),e.jsxs("div",{className:"streamer-info",children:[e.jsx("span",{className:"streamer-name",children:a.display_name}),e.jsxs("span",{className:"streamer-stats",children:["평균 시청자 ",a.viewers_avg?.toLocaleString(),"명"]})]}),c&&e.jsx(K,{size:16,className:"streamer-check"})]},a.id)})}),N.length>0&&e.jsx("div",{className:"selected-streamers",children:N.map(a=>e.jsxs("span",{className:"selected-streamer-tag",children:[a.display_name,e.jsx("button",{type:"button",onClick:()=>p(a.id),children:e.jsx(re,{size:12})})]},a.id))})]})}),e.jsx("div",{className:"form-row single",style:{marginTop:"20px"},children:e.jsxs("div",{className:"form-field",children:[e.jsx("label",{children:"타겟 카테고리 (선택)"}),e.jsx("div",{className:"targeting-grid",style:{gridTemplateColumns:"repeat(3, 1fr)"},children:b.map(a=>e.jsx("div",{className:`targeting-option ${i.target_categories.includes(a.id)?"selected":""}`,onClick:()=>v(a.id),children:e.jsx("span",{children:a.label})},a.id))}),e.jsx("span",{className:"hint",children:"선택하지 않으면 모든 카테고리에 노출됩니다."})]})})]}),e.jsxs("div",{className:"campaign-form-card",children:[e.jsxs("h3",{children:[e.jsx(D,{size:18})," 예산 설정"]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-field",children:[e.jsx("label",{children:"일일 예산 (KRW)"}),e.jsxs("div",{className:"budget-input-wrapper",children:[e.jsx("span",{className:"budget-currency",children:"₩"}),e.jsx("input",{type:"number",placeholder:"0",value:i.budget_daily||"",onChange:a=>x("budget_daily",parseInt(a.target.value)||0)})]}),e.jsx("span",{className:"hint",children:"하루에 사용할 최대 금액 (0 = 제한 없음)"})]}),e.jsxs("div",{className:"form-field",children:[e.jsx("label",{children:"총 예산 (KRW) *"}),e.jsxs("div",{className:"budget-input-wrapper",children:[e.jsx("span",{className:"budget-currency",children:"₩"}),e.jsx("input",{type:"number",placeholder:"0",value:i.budget_total||"",onChange:a=>x("budget_total",parseInt(a.target.value)||0)})]}),n.budget&&e.jsx("span",{className:"hint",style:{color:"#ef4444"},children:n.budget})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-field",children:[e.jsx("label",{children:"CPM (1,000회 노출당 비용)"}),e.jsxs("div",{className:"budget-input-wrapper",children:[e.jsx("span",{className:"budget-currency",children:"₩"}),e.jsx("input",{type:"number",placeholder:"1000",value:i.cpm||"",onChange:a=>x("cpm",parseInt(a.target.value)||0)})]})]}),e.jsxs("div",{className:"form-field",children:[e.jsx("label",{children:"CPC (클릭당 비용)"}),e.jsxs("div",{className:"budget-input-wrapper",children:[e.jsx("span",{className:"budget-currency",children:"₩"}),e.jsx("input",{type:"number",placeholder:"100",value:i.cpc||"",onChange:a=>x("cpc",parseInt(a.target.value)||0)})]})]})]})]}),e.jsxs("div",{className:"campaign-form-card",children:[e.jsxs("h3",{children:[e.jsx(q,{size:18})," 기간 설정"]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-field",children:[e.jsx("label",{children:"시작일 *"}),e.jsx("input",{type:"date",value:i.start_date,onChange:a=>x("start_date",a.target.value)}),n.start_date&&e.jsx("span",{className:"hint",style:{color:"#ef4444"},children:n.start_date})]}),e.jsxs("div",{className:"form-field",children:[e.jsx("label",{children:"종료일 *"}),e.jsx("input",{type:"date",value:i.end_date,onChange:a=>x("end_date",a.target.value)}),n.end_date&&e.jsx("span",{className:"hint",style:{color:"#ef4444"},children:n.end_date})]})]})]}),n.submit&&e.jsx("div",{style:{padding:"12px 16px",background:"#fef2f2",borderRadius:"8px",color:"#ef4444",marginBottom:"20px"},children:n.submit}),e.jsxs("div",{className:"campaign-form-actions",children:[e.jsx("button",{type:"button",className:"btn-cancel",onClick:o,children:"취소"}),e.jsx("button",{type:"submit",className:"btn-submit",disabled:l,children:l?e.jsxs(e.Fragment,{children:[e.jsx(W,{size:16,className:"spin"}),"저장 중..."]}):e.jsxs(e.Fragment,{children:[e.jsx(K,{size:16}),z?"캠페인 수정":"캠페인 생성"]})})]})]})]})},Ne=({campaign:s,onBack:o,onEdit:P})=>{const[i,m]=d.useState({impressions:0,clicks:0,spent:0,ctr:0,daily:[]}),[N,j]=d.useState(!0);d.useEffect(()=>{s?.id&&F()},[s]);const F=async()=>{j(!0);try{const l=localStorage.getItem("token"),h=await fetch(`${$}/api/ads/campaigns/${s.id}/stats`,{headers:{Authorization:`Bearer ${l}`}});if(h.ok){const n=await h.json();m({impressions:n.impressions||s.impressions||0,clicks:n.clicks||s.clicks||0,spent:n.spent||s.spent||0,ctr:n.ctr||(n.impressions>0?(n.clicks/n.impressions*100).toFixed(2):0),daily:n.daily||[]})}else m({impressions:s.impressions||0,clicks:s.clicks||0,spent:s.spent||0,ctr:s.impressions>0?(s.clicks/s.impressions*100).toFixed(2):0,daily:[]})}catch(l){console.error("Failed to fetch campaign stats",l),m({impressions:s.impressions||0,clicks:s.clicks||0,spent:s.spent||0,ctr:s.impressions>0?(s.clicks/s.impressions*100).toFixed(2):0,daily:[]})}finally{j(!1)}},T=async l=>{try{const h=localStorage.getItem("token");(await fetch(`${$}/api/ads/campaigns/${s.id}/status`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${h}`},body:JSON.stringify({status:l})})).ok&&(s.status=l,F())}catch(h){console.error("Failed to update campaign status",h)}},u=l=>l>=1e6?(l/1e6).toFixed(1)+"M":l>=1e3?(l/1e3).toFixed(1)+"K":l?.toLocaleString()||"0",_=l=>l?new Date(l).toLocaleDateString("ko-KR",{year:"numeric",month:"long",day:"numeric"}):"-",g=l=>{switch(l){case"active":return"활성";case"pending":return"대기중";case"paused":return"일시정지";case"completed":return"완료됨";default:return l}},k=(()=>{try{return s.target_categories?JSON.parse(s.target_categories):[]}catch{return[]}})(),C={game:"게임",talk:"토크/잡담",music:"음악",art:"그림/창작",sports:"스포츠",education:"교육"},f=s.budget_total>0?Math.min(100,i.spent/s.budget_total*100):0;return e.jsxs("div",{className:"animate-fade",children:[e.jsxs("div",{className:"campaign-detail-header",children:[e.jsxs("div",{className:"campaign-detail-title",children:[e.jsx("button",{className:"btn-outline",style:{padding:"10px",borderRadius:"10px"},onClick:o,children:e.jsx(Q,{size:18})}),e.jsxs("div",{children:[e.jsx("h1",{children:s.name}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginTop:"8px"},children:[e.jsxs("span",{className:`campaign-status-badge ${s.status}`,children:[e.jsx("span",{className:"status-dot"}),g(s.status)]}),e.jsx("span",{style:{fontSize:"13px",color:"var(--text-muted)"},children:s.content_type==="video"?"영상 광고":"이미지 광고"})]})]})]}),e.jsxs("div",{className:"campaign-detail-actions",children:[s.status==="active"?e.jsxs("button",{className:"btn-outline",onClick:()=>T("paused"),children:[e.jsx(Z,{size:16})," 일시정지"]}):s.status==="paused"?e.jsxs("button",{className:"btn-outline",onClick:()=>T("active"),children:[e.jsx(ee,{size:16})," 재시작"]}):null,e.jsxs("button",{className:"btn-primary",onClick:P,children:[e.jsx(se,{size:16})," 수정"]})]})]}),e.jsxs("div",{className:"campaign-stats-grid",style:{marginBottom:"24px"},children:[e.jsxs("div",{className:"campaign-stat-card",children:[e.jsxs("div",{className:"campaign-stat-header",children:[e.jsx("span",{children:"총 노출"}),e.jsx("div",{className:"campaign-stat-icon blue",children:e.jsx(ae,{size:18})})]}),e.jsx("span",{className:"campaign-stat-value",children:u(i.impressions)})]}),e.jsxs("div",{className:"campaign-stat-card",children:[e.jsxs("div",{className:"campaign-stat-header",children:[e.jsx("span",{children:"총 클릭"}),e.jsx("div",{className:"campaign-stat-icon green",children:e.jsx(te,{size:18})})]}),e.jsx("span",{className:"campaign-stat-value",children:u(i.clicks)})]}),e.jsxs("div",{className:"campaign-stat-card",children:[e.jsxs("div",{className:"campaign-stat-header",children:[e.jsx("span",{children:"CTR"}),e.jsx("div",{className:"campaign-stat-icon orange",children:e.jsx(ie,{size:18})})]}),e.jsxs("span",{className:"campaign-stat-value",children:[i.ctr,"%"]})]}),e.jsxs("div",{className:"campaign-stat-card",children:[e.jsxs("div",{className:"campaign-stat-header",children:[e.jsx("span",{children:"지출 금액"}),e.jsx("div",{className:"campaign-stat-icon purple",children:e.jsx(D,{size:18})})]}),e.jsxs("span",{className:"campaign-stat-value",children:["₩",u(i.spent)]})]})]}),e.jsxs("div",{className:"campaign-detail-grid",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"campaign-detail-card",style:{marginBottom:"24px"},children:[e.jsxs("h3",{children:[e.jsx(le,{size:18})," 성과 추이"]}),e.jsx("div",{className:"chart-placeholder",children:N?e.jsx("span",{children:"데이터 로딩 중..."}):i.daily&&i.daily.length>0?e.jsx("span",{children:"차트 데이터 준비됨 (차트 라이브러리 연동 필요)"}):e.jsx("span",{children:"아직 충분한 데이터가 없습니다."})})]}),e.jsxs("div",{className:"campaign-detail-card",children:[e.jsxs("h3",{children:[s.content_type==="video"?e.jsx(J,{size:18}):e.jsx(E,{size:18}),"광고 미리보기"]}),e.jsx("div",{className:"campaign-preview",children:s.content_url?s.content_type==="video"?e.jsx("video",{src:s.content_url,controls:!0,style:{maxWidth:"100%"}}):e.jsx("img",{src:s.content_url,alt:s.name,style:{maxWidth:"100%"}}):e.jsx("div",{style:{padding:"40px",color:"var(--text-muted)"},children:"미리보기 이미지 없음"})}),s.click_url&&e.jsx("div",{style:{marginTop:"16px",textAlign:"center"},children:e.jsxs("a",{href:s.click_url,target:"_blank",rel:"noopener noreferrer",style:{display:"inline-flex",alignItems:"center",gap:"6px",color:"var(--primary)",fontSize:"13px",fontWeight:"500"},children:[e.jsx(de,{size:14}),"랜딩 페이지 열기"]})})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"campaign-detail-card",style:{marginBottom:"24px"},children:[e.jsxs("h3",{children:[e.jsx(D,{size:18})," 예산 정보"]}),e.jsxs("div",{className:"campaign-info-list",children:[e.jsxs("div",{className:"campaign-info-item",children:[e.jsx("span",{className:"campaign-info-label",children:"총 예산"}),e.jsxs("span",{className:"campaign-info-value",children:["₩",s.budget_total?.toLocaleString()]})]}),e.jsxs("div",{className:"campaign-info-item",children:[e.jsx("span",{className:"campaign-info-label",children:"일일 예산"}),e.jsx("span",{className:"campaign-info-value",children:s.budget_daily>0?`₩${s.budget_daily.toLocaleString()}`:"제한 없음"})]}),e.jsxs("div",{className:"campaign-info-item",children:[e.jsx("span",{className:"campaign-info-label",children:"CPM"}),e.jsxs("span",{className:"campaign-info-value",children:["₩",s.cpm?.toLocaleString()]})]}),e.jsxs("div",{className:"campaign-info-item",children:[e.jsx("span",{className:"campaign-info-label",children:"CPC"}),e.jsxs("span",{className:"campaign-info-value",children:["₩",s.cpc?.toLocaleString()]})]}),e.jsxs("div",{className:"campaign-info-item",children:[e.jsx("span",{className:"campaign-info-label",children:"예산 소진율"}),e.jsxs("span",{className:"campaign-info-value",children:[f.toFixed(1),"%"]})]})]}),e.jsxs("div",{style:{marginTop:"16px"},children:[e.jsx("div",{style:{height:"8px",background:"var(--bg-sidebar)",borderRadius:"4px",overflow:"hidden"},children:e.jsx("div",{style:{width:`${f}%`,height:"100%",background:f>90?"#ef4444":f>70?"#f97316":"#10b981",borderRadius:"4px",transition:"width 0.3s ease"}})}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"8px",fontSize:"12px",color:"var(--text-muted)"},children:[e.jsxs("span",{children:["₩",i.spent?.toLocaleString()," 사용"]}),e.jsxs("span",{children:["₩",(s.budget_total-i.spent).toLocaleString()," 남음"]})]})]})]}),e.jsxs("div",{className:"campaign-detail-card",style:{marginBottom:"24px"},children:[e.jsxs("h3",{children:[e.jsx(q,{size:18})," 기간"]}),e.jsxs("div",{className:"campaign-info-list",children:[e.jsxs("div",{className:"campaign-info-item",children:[e.jsx("span",{className:"campaign-info-label",children:"시작일"}),e.jsx("span",{className:"campaign-info-value",children:_(s.start_date)})]}),e.jsxs("div",{className:"campaign-info-item",children:[e.jsx("span",{className:"campaign-info-label",children:"종료일"}),e.jsx("span",{className:"campaign-info-value",children:_(s.end_date)})]}),e.jsxs("div",{className:"campaign-info-item",children:[e.jsx("span",{className:"campaign-info-label",children:"생성일"}),e.jsx("span",{className:"campaign-info-value",children:_(s.created_at)})]})]})]}),e.jsxs("div",{className:"campaign-detail-card",children:[e.jsxs("h3",{children:[e.jsx(X,{size:18})," 타겟팅"]}),e.jsxs("div",{className:"campaign-info-list",children:[e.jsxs("div",{className:"campaign-info-item",children:[e.jsx("span",{className:"campaign-info-label",children:"노출 대상"}),e.jsx("span",{className:"campaign-info-value",children:s.target_streamers==="all"?"전체 스트리머":"선택한 스트리머"})]}),k.length>0&&e.jsxs("div",{className:"campaign-info-item",style:{flexDirection:"column",alignItems:"flex-start",gap:"8px"},children:[e.jsx("span",{className:"campaign-info-label",children:"타겟 카테고리"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"6px"},children:k.map(l=>e.jsx("span",{style:{padding:"4px 10px",background:"var(--primary-light)",color:"var(--primary)",borderRadius:"50px",fontSize:"12px",fontWeight:"500"},children:C[l]||l},l))})]})]})]})]})]})]})},be=()=>{const[s,o]=d.useState("list"),[P,i]=d.useState([]),[m,N]=d.useState({totalImpressions:0,totalClicks:0,totalSpent:0,activeCampaigns:0}),[j,F]=d.useState("all"),[T,u]=d.useState(null),[_,g]=d.useState(!0),{user:k,isAuthenticated:C,logout:f}=oe(),l=me();d.useEffect(()=>{C&&h()},[C]);const h=async()=>{g(!0);try{const t=localStorage.getItem("token"),p=await fetch(`${$}/api/ads/campaigns`,{headers:{Authorization:`Bearer ${t}`}});if(p.ok){const v=await p.json();i(v),n(v)}}catch(t){console.error("Failed to fetch campaigns",t)}finally{g(!1)}},n=t=>{const p=t.reduce((b,I)=>b+(I.impressions||0),0),v=t.reduce((b,I)=>b+(I.clicks||0),0),B=t.reduce((b,I)=>b+(I.spent||0),0),U=t.filter(b=>b.status==="active").length;N({totalImpressions:p,totalClicks:v,totalSpent:B,activeCampaigns:U})},S=async(t,p)=>{try{const v=localStorage.getItem("token");(await fetch(`${$}/api/ads/campaigns/${t}/status`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${v}`},body:JSON.stringify({status:p})})).ok&&h()}catch(v){console.error("Failed to update campaign status",v)}},R=async t=>{if(confirm("정말 이 캠페인을 삭제하시겠습니까?"))try{const p=localStorage.getItem("token");(await fetch(`${$}/api/ads/campaigns/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${p}`}})).ok&&h()}catch(p){console.error("Failed to delete campaign",p)}},z=j==="all"?P:P.filter(t=>t.status===j),w=t=>t>=1e6?(t/1e6).toFixed(1)+"M":t>=1e3?(t/1e3).toFixed(1)+"K":t.toLocaleString(),x=()=>e.jsxs("div",{className:"animate-fade",children:[e.jsxs("header",{className:"page-header",children:[e.jsxs("div",{className:"page-title",children:[e.jsx("h1",{children:"광고 캠페인 관리"}),e.jsx("p",{children:"캠페인을 생성하고 성과를 모니터링하세요."})]}),e.jsx("div",{className:"header-buttons",children:e.jsxs("button",{className:"btn-primary",onClick:()=>o("create"),children:[e.jsx(M,{size:16})," 새 캠페인 만들기"]})})]}),e.jsxs("div",{className:"campaign-stats-grid",children:[e.jsxs("div",{className:"campaign-stat-card",children:[e.jsxs("div",{className:"campaign-stat-header",children:[e.jsx("span",{children:"총 노출"}),e.jsx("div",{className:"campaign-stat-icon blue",children:e.jsx(ae,{size:18})})]}),e.jsx("span",{className:"campaign-stat-value",children:w(m.totalImpressions)}),e.jsx("span",{className:"campaign-stat-change positive",children:"+12.5% 이번 주"})]}),e.jsxs("div",{className:"campaign-stat-card",children:[e.jsxs("div",{className:"campaign-stat-header",children:[e.jsx("span",{children:"총 클릭"}),e.jsx("div",{className:"campaign-stat-icon green",children:e.jsx(te,{size:18})})]}),e.jsx("span",{className:"campaign-stat-value",children:w(m.totalClicks)}),e.jsx("span",{className:"campaign-stat-change positive",children:"+8.3% 이번 주"})]}),e.jsxs("div",{className:"campaign-stat-card",children:[e.jsxs("div",{className:"campaign-stat-header",children:[e.jsx("span",{children:"총 지출"}),e.jsx("div",{className:"campaign-stat-icon orange",children:e.jsx(D,{size:18})})]}),e.jsxs("span",{className:"campaign-stat-value",children:["₩",w(m.totalSpent)]}),e.jsx("span",{className:"campaign-stat-change negative",children:"-2.1% 이번 주"})]}),e.jsxs("div",{className:"campaign-stat-card",children:[e.jsxs("div",{className:"campaign-stat-header",children:[e.jsx("span",{children:"활성 캠페인"}),e.jsx("div",{className:"campaign-stat-icon purple",children:e.jsx(ie,{size:18})})]}),e.jsx("span",{className:"campaign-stat-value",children:m.activeCampaigns}),e.jsx("span",{className:"campaign-stat-change positive",children:"2개 진행 중"})]})]}),e.jsxs("div",{className:"campaigns-section",children:[e.jsxs("div",{className:"campaigns-header",children:[e.jsx("h2",{children:"캠페인 목록"}),e.jsx("div",{className:"campaigns-filters",children:e.jsxs("select",{className:"filter-select",value:j,onChange:t=>F(t.target.value),children:[e.jsx("option",{value:"all",children:"모든 상태"}),e.jsx("option",{value:"active",children:"활성"}),e.jsx("option",{value:"pending",children:"대기중"}),e.jsx("option",{value:"paused",children:"일시정지"}),e.jsx("option",{value:"completed",children:"완료됨"})]})})]}),z.length===0?e.jsxs("div",{className:"campaigns-empty",children:[e.jsx("div",{className:"campaigns-empty-icon",children:e.jsx(G,{size:28})}),e.jsx("h3",{children:"캠페인이 없습니다"}),e.jsx("p",{children:"새로운 광고 캠페인을 생성하여 스트리머들에게 광고를 노출해보세요."}),e.jsxs("button",{className:"btn-primary",onClick:()=>o("create"),children:[e.jsx(M,{size:16})," 첫 캠페인 만들기"]})]}):e.jsxs("div",{className:"campaigns-table",children:[e.jsxs("div",{className:"campaigns-table-header",children:[e.jsx("span",{children:"캠페인"}),e.jsx("span",{children:"상태"}),e.jsx("span",{children:"노출"}),e.jsx("span",{children:"클릭"}),e.jsx("span",{children:"CTR"}),e.jsx("span",{children:"지출"}),e.jsx("span",{children:"액션"})]}),z.map(t=>{const p=t.impressions>0?(t.clicks/t.impressions*100).toFixed(2):"0.00";return e.jsxs("div",{className:"campaigns-table-row",children:[e.jsxs("div",{className:"campaign-name-cell",children:[t.content_url?t.content_type==="video"?e.jsx("video",{className:"campaign-thumbnail",src:t.content_url,muted:!0}):e.jsx("img",{className:"campaign-thumbnail",src:t.content_url,alt:t.name}):e.jsx("div",{className:"campaign-thumbnail-placeholder",children:t.content_type==="video"?e.jsx(J,{size:20}):e.jsx(E,{size:20})}),e.jsxs("div",{className:"campaign-name-info",children:[e.jsx("span",{className:"campaign-name",style:{cursor:"pointer"},onClick:()=>{u(t),o("detail")},children:t.name}),e.jsx("span",{className:"campaign-type",children:t.content_type==="video"?"영상 광고":"이미지 광고"})]})]}),e.jsx("div",{children:e.jsxs("span",{className:`campaign-status-badge ${t.status}`,children:[e.jsx("span",{className:"status-dot"}),t.status==="active"&&"활성",t.status==="pending"&&"대기중",t.status==="paused"&&"일시정지",t.status==="completed"&&"완료됨"]})}),e.jsx("div",{className:"campaign-metric",children:w(t.impressions||0)}),e.jsx("div",{className:"campaign-metric",children:w(t.clicks||0)}),e.jsxs("div",{className:"campaign-metric",children:[p,"%"]}),e.jsxs("div",{className:"campaign-metric",children:["₩",w(t.spent||0)]}),e.jsxs("div",{className:"campaign-actions",children:[t.status==="active"?e.jsx("button",{className:"action-btn",title:"일시정지",onClick:()=>S(t.id,"paused"),children:e.jsx(Z,{size:14})}):t.status==="paused"?e.jsx("button",{className:"action-btn",title:"재시작",onClick:()=>S(t.id,"active"),children:e.jsx(ee,{size:14})}):null,e.jsx("button",{className:"action-btn",title:"편집",onClick:()=>{u(t),o("edit")},children:e.jsx(se,{size:14})}),e.jsx("button",{className:"action-btn danger",title:"삭제",onClick:()=>R(t.id),children:e.jsx(ve,{size:14})})]})]},t.id)})]})]})]}),O=()=>{if(!C)return e.jsx("div",{className:"animate-fade",children:e.jsxs("div",{className:"placeholder-view",children:[e.jsx(G,{size:64,style:{color:"var(--border-medium)"},strokeWidth:1}),e.jsx("h3",{style:{color:"var(--text-main)",marginTop:"20px"},children:"로그인이 필요합니다"}),e.jsx("p",{children:"광고 캠페인을 관리하려면 먼저 로그인해주세요."}),e.jsxs("button",{className:"btn-primary",style:{marginTop:"24px"},onClick:()=>l("/login"),children:[e.jsx(V,{size:16})," 로그인하기"]})]})});switch(s){case"create":return e.jsx(H,{onBack:()=>o("list"),onSuccess:()=>{o("list"),h()}});case"edit":return e.jsx(H,{campaign:T,onBack:()=>{u(null),o("list")},onSuccess:()=>{u(null),o("list"),h()}});case"detail":return e.jsx(Ne,{campaign:T,onBack:()=>{u(null),o("list")},onEdit:()=>o("edit")});default:return x()}};return e.jsxs("div",{className:"advertiser-layout",children:[e.jsxs("aside",{className:"chatgpt-sidebar",children:[e.jsx("div",{className:"sidebar-top",children:e.jsxs("div",{className:"app-logo",children:[e.jsx("div",{className:"logo-icon",children:"A"}),e.jsx("span",{className:"logo-text",children:"Ad Manager"})]})}),e.jsxs("nav",{className:"sidebar-nav",children:[e.jsxs("div",{className:"nav-group",children:[e.jsx("span",{className:"group-label",children:"광고 관리"}),e.jsxs("button",{className:`nav-item ${s==="list"?"active":""}`,onClick:()=>o("list"),children:[e.jsx(he,{size:18}),e.jsx("span",{className:"nav-label",children:"캠페인 목록"})]}),e.jsxs("button",{className:`nav-item ${s==="create"?"active":""}`,onClick:()=>{u(null),o("create")},children:[e.jsx(M,{size:18}),e.jsx("span",{className:"nav-label",children:"새 캠페인"})]})]}),e.jsxs("div",{className:"nav-group",children:[e.jsx("span",{className:"group-label",children:"분석"}),e.jsxs("button",{className:"nav-item",children:[e.jsx(le,{size:18}),e.jsx("span",{className:"nav-label",children:"성과 분석"})]})]})]}),e.jsx("div",{className:"sidebar-user",children:C?e.jsxs("div",{className:"user-profile",title:"계정 설정",children:[e.jsx("div",{className:"avatar",children:k?.displayName?.charAt(0)?.toUpperCase()||"A"}),e.jsxs("div",{className:"user-info",children:[e.jsx("span",{className:"username",style:{color:"var(--text-main)"},children:k?.displayName||"광고주"}),e.jsx("span",{className:"user-plan",children:"광고주 계정"})]}),e.jsx("button",{className:"logout-btn",onClick:t=>{t.stopPropagation(),f(),l("/")},title:"로그아웃",children:e.jsx(xe,{size:16})})]}):e.jsxs("button",{className:"login-btn",onClick:()=>l("/login"),style:{width:"100%"},children:[e.jsx(V,{size:18}),e.jsx("span",{className:"login-text",children:"로그인"})]})})]}),e.jsxs("main",{className:"advertiser-main",children:[e.jsxs("header",{className:"top-nav",children:[e.jsxs("div",{className:"search-container",children:[e.jsx(Y,{className:"search-icon",size:16}),e.jsx("input",{type:"text",placeholder:"캠페인 검색..."})]}),e.jsxs("div",{className:"top-actions",children:[e.jsx("button",{className:"action-icon-btn",children:e.jsx(pe,{size:18})}),e.jsx("button",{className:"action-icon-btn",children:e.jsx(je,{size:18})}),e.jsxs("button",{className:"btn-outline",onClick:()=>l("/"),children:["스트리머 대시보드",e.jsx(ue,{size:14})]})]})]}),e.jsx("div",{className:"advertiser-content",children:_&&s==="list"?e.jsx(ge,{}):O()})]})]})};export{be as default};
